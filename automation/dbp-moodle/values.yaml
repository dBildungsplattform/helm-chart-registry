global:
  name: infra
  stage: infra
  kubectl_version: "1.28.7"
  infratools_image_tag: 4.0.3
  storageClass: "nfs-client"
  moodlePlugins:
    kaltura:
      enabled: false
    etherpadlite:
      enabled: false
    hvp:
      enabled: false
    groupselect:
      enabled: false
    jitsi:
      enabled: false
    pdfannotator:
      enabled: false
    tiles:
      enabled: false
    skype:
      enabled: false
    zoom:
      enabled: false
    booking:
      enabled: false
    reengagement:
      enabled: false
    unilabel:
      enabled: false
    geogebra:
      enabled: false
    remuiformat:
      enabled: false
    topcoll:
      enabled: false
    oidc:
      enabled: false
    saml2:
      enabled: false
    dash:
      enabled: false
    sharing_cart:
      enabled: false
    xp:
      enabled: false
    certificate:
      enabled: false
    coursecertificate:
      enabled: false
    boost_union:
      enabled: false

dbpMoodle:
  logging: false
  debug: false # Moodle Debugging is not safe for production

  # The dbp update process to migrate moodle date when Moodle versions are increased
  update_migration:
    enabled: false

  enable_plugin_install: true

  redis:
    host: "moodle-redis-master"
    port: 6379
    password: "moodle"

  external_pvc:
    enabled: true
    name: "moodle-data"
    size: "8Gi"
    storage_class: "nfs-client"
    accessModes: ["ReadWriteOnce"]
    annotations:
      "helm.sh/resource-policy": "keep"

  secrets:
    useChartSecret: true
    moodle_password: "moodle"
    postgres_password: "moodle"
    mariadb_password: "moodle"
    mariadb_root_password: "moodle"
    etherpad_postgresql_password: "moodle"
    etherpad_api_key: "moodle"

  updateHelper:
    rules:
      - apiGroups: [""]
        resources: ["pods", "pods/exec", "secrets", "persistentvolumeclaims", "services", "deployments"]
        verbs: ["get", "list", "create", "delete", "patch", "update"]
      - apiGroups: ["apps"]
        resources: ["deployments", "replicasets", "deployments/scale"]
        verbs: ["get", "list", "create", "delete", "patch", "update"]
      - apiGroups: ["networking.k8s.io"]
        resources: ["ingresses"]
        verbs: ["get", "list", "create", "delete", "patch", "update"]
      - apiGroups: ["batch"]
        resources: ["cronjobs", "jobs"]
        verbs: ["get", "list", "create", "delete", "patch", "update"]
      - apiGroups: ["autoscaling"]
        resources: ["horizontalpodautoscalers"]
        verbs: ["get", "list", "create", "patch", "update"]

  backup:
    enabled: enabled
    gpg_key_names: dbpinfra
    gpgkeys:
      gpgkey.dbpinfra.pub.asc: LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkdXZjNyWUJFQURTY0FsRlJlVTV4MnYya1B5aTJvVGpvbk5OaEZKK2hSaHFyc29zWVVFR1NaWDY3MXh1CjlPb0wvWlRrZm84R0c1RkwyU0JkTWZOV2FaenE5WFE0MmNUa2NJYUp4Qnd6YXhYZWhDTjNualQwS2dqQUpXVFQKTzd4YjAwMnpBanZobUQycyt2SmUvOWE4c0NpRkZRbDV0aWpWTHlVb3RCa1Q1MnFoWEpKQmR2QWpmVElESmtsYwp5dnBLSFdURTRJd0w3Ymt0YW9wWVNIVEVwRFZMd2RtWWo4M3JYdFZ3YUFXcXBkVUtUOTJrRjFodzRWV0c3TEhlCjhOVXo0VEdkY1lEZjZCQkpnSHR5Njg0blhCMndmcFlvQ2RSRHc2SzVNc3BiUlBLcTdqYzBKV2hteldqeEJscisKVjZOblJKaDZRY00rZWhCaFRGTUxKMjJGUGpkQmVuWUFrQTNxbDFWWFJPNGdTb3FQRHRhQTZhOGk3Q1pkVGhBSwpVL0I3K0luTk9MY1NSUUNlMzJjOTR2RG9JUUFyOFQ4c0JmQnBJZExhMG1OZHB4QTErSDZSQWt2Rk4yOWc5cElOCjZxQ2VoK2lveFpjbDc2N0xtdXFOY0hNWEJUbGVpSEpRK1AybHFaSkJJTFJrZks0TG84anVrZWxVWVVGd2x2S3QKcVU0WkdFL2NLeGVYZWpSaDkrYzBLUkloOUJUZFFFbm1FcERlZEtFYUU4U2Z1NENVdHZpQW5VS2hBVkcyaU5xMgpud0pSY0YyMVlwK292UHB5ZC9qMHgzT2taSjJDRmJZcEtjN2Yvd0tEdnRnL0hHcVZoRm5XYkNzbFZHY1VGbGFTCitiV01ZOTR5aC9mRUxVVGcwM25LRnA2NUxaVDQ0WkpjaXBxTUVjS3VjZisyNThVaGFiWTlMWUw2ZlFBUkFRQUIKdENka1luQnBibVp5WVNBOFpHVjJiM0J6UUdSaWFXeGtkVzVuYzNCc1lYUjBabTl5YlM1a1pUNkpBazRFRXdFSwpBRGdXSVFUY09ac09zOElIeDlMaVprK3BvSVYxWEdVdmlnVUNaWi9ldGdJYkF3VUxDUWdIQWdZVkNna0lDd0lFCkZnSURBUUllQVFJWGdBQUtDUkNwb0lWMVhHVXZpdEpWRUFDcGNRRkZzWXF4WThxa3dlL2RKaUVmRUMvUFVIWnkKcmttNkVkNTBwOENqUWVLa0xGd2xZQkVHWU8vMWdNTHAvOElXclEvMEZLbkpOZW9tcmh0TE5XMGN6dzBpdUhGRgpzcFZPYzBQd0RzL3dMLzgzejJpT1JTcm5zMnlCb2xNUW5HVDJhQ1JuNXNhZU5OZWRmNThUREFoanhOVENiLy9ECkRMb3pDaTR1d0hKQUNNWGlWMHVmUXkxcEd0a3ZDamZVeTcyODZ0eWJaQjhHTytNWU5KaUVpRVV2T3RVekNoS1kKRW5VT21JMmtCc1BQZnMwMUFJZUpxY2xVVXVsQ2J5VkRjeU1FL3Q5ZklZZlVaZG9qbVJNUWZmWlJMMG9RcVhpVworbWQxVHhnOWM0Nk5iRkRpcGxzaFdWeDEvNWhwZ1QzRGpKL2libHZwbVdTczlZclNyejhXd1VPYS9VMGgrVHhuCjNvbEpVR3h2LzR6MUJRRitMSC9nRHh3dWpBeDgxVk0rQllBRjhPRWd6ZXpEOWhMamtxb2Y1ZDl3NTRiSG1nRzAKZzBaRndraVhHbUZlVUkyU0JwdGx3SlFSNWQ3RVZ2M0pSK0ZJanVXZ3hZZVBRNDNoVlppM2N5TUswck9OUDFVTwpCbm9tV2xKanZjYVppWFRDNWMyWEd4eUZrRzVmbEE1VitDdGRHbEd2UjZVMmRtUUtTZHhJbHNhYml4cDk5di8yClBXamxJYnlxZm9Hc2l6Yk1KcFBUMzBWaDFvOXM1c3p5UUp2WEZiemR1Qm9jdVRmMXJqemthS1ErRmNSRlF0eTUKM0NZZFlnU3dobnBxVUV5OWNFRkV0alRKWlFOZzdlM09MRDZ5Vm1pcDdzejArK0xxbG9aV0R2d0ZiSzBOSDg5YgpZSDN4eFZkU0FrMThZN2tDRFFSbG45NjJBUkFBdjJCVGlBZzVyUnNoZmRJcVdyNUErQlhMdFpJMXFCQzYyL1ZUCjZtVXlhN3J6SXVXVi8rSGdoQVczK0FKN29hcnlCSERZbDNjNUJITWVXVVRYMndYenZKU0RrdDc0d012WEMzU3UKQkVaRWVCRmpwMkZ2RlRpWVpwTFgwelRLYXoydThqck1DUDdxMGwrczNwR1JHd2haV2d1K2pFaWRCaWV3dkNTbwpQS29SZlJRamhRSk9SZDVuaFM5d1M4OG9renBKenN4YlhHM2lLUDg5dnU1WU94Z0dJZDVMUXlSMUoxMWJQdENvCndOQ1pDVFNTNDA1YnR0OGxGSVZKS0d5a1huQmIyNjFsc0l6TTYvdTZnS21HZXRoZ3B6ODJvOXJCR1hXMnoyY24KNEZwUmoraTlveDlMOHYvTjUrdnZwY0hYY3RoWFFFbUE1Y2U0elRkd2JndDdsN1lseDdRU2dYWFFiMDBwU3ZvRQpLakxRUGR1a2s1QzV4WURQTEhCb1B5b0JSMWwwdjA3a0FUUm10UTJyRFhDZkNoMktWdjQ5MitoWSsyZFpFMlF1CjJxaUt0RG5uWWh5b1VpVlJkSW1yWGNuZGRBK013Yy9Lbit5bjQ0Qi82MUxKNC90WFhnUG9OTGYxQStDbFdYbDEKcmQ4RXprNHk3anFVbEQ3ZU9BdFM5MnN0eXBFUmwzRUpoTGZtazhpblhvUXpDWm5sOTMwckZCUjJyMGpZT3FPTQp5WWN0RitUYUMwNzdUT3lZeFBVa3IwVTVtc3dTeUF5VEFFSWJHbXMrbmszWUhsa1VqYXlQQ0IxcVgxaklHVFVtCjJFSEtjUS9zZm5kZlU4SWFLUFZxa0xCYzU0c2NCRnZTby9rTGNoclhLeVBQeE1mbW5yYUM3YzBUOTBxTisxSi8KcXB6dHdiTUFFUUVBQVlrQ05nUVlBUW9BSUJZaEJOdzVtdzZ6d2dmSDB1Sm1UNm1naFhWY1pTK0tCUUpsbjk2MgpBaHNNQUFvSkVLbWdoWFZjWlMrS0FOd1AvMXg3elJRZ3NyM0RJWElQMlhQaFplV2VMVHN2UGZWM01JT3hjNTdGClVHM01vbmNvUC9vcStnaTQ1aXFLNVFKbHN6aG9lUGtqUG1taFJwcGtkMURrMUlMUVZwZkZGOEZlendYY3lnWEUKYXp3djdiUzZveDVMZW1uMy9nRHNpeUN4TzBuWTQrRGhBT2M4KzhKOVRNMDQ0SlJFZGNhb3hsenpNajhuTnZ3YQoyVW9Db3pqdER4dTRQQWNzQkZUVEJhalVaS2NRaGhIR0h5bkxuMTU0dzBBL0Rwa3FrZnpoVVBuZ3dENktQTHVWCmJ0UUNPM004VUNHSEhhZFNraGx4LzhLREI5WGkwMDB5NkdFSGZDSTFFaFF1VnV4ek85Ykl6ckpNTllrSjBxdXgKNmNOZmVNSHRERUpPWFVKZVdzUUJ3aGlLa25xajdOU1dqWk5VenRja1VtQ01XazBOY2svK3RRejM5OW00cHVocQoyenI1QlFNVDk0d1ByMll2UXBzcjREdEdiZ1BVVi9jYUtjaDlEWGdKSEsvaWtobCtnWXovVHAxNXRyOFlSdGVjCjBpWTZWU2JFaEExZzBMQW9uaXhsYS9BTlk4NlpEaE9aNEdKK0RLalpQb1RPMTIrZ3lJMWtYN0d3V0w2OE5HUHYKV0E5V3pMazF3NXZ4V0hldHFZL3ViVlhiMlVZV3JuOUpWT3IwbHJ3US80QmVMbnlFcXpSTlgwd0RKTGxtOE11UApLd1Z5bEpUc3d3WkFrRTVSQWY3M0d6ZWQ3SlUxblg1QUI1Y1JPWElsYjlKUzh2VTBqbnpsd3RqMFZSTnN6WHlDCjhtZSt6cTh1R3pETXp4a0E2OXpqdFFYU3FBNnEvMXNlSGFKUVg5TXVSNERMYTIzaHFUZSt0ZTk2blA2QkN0VCsKaEljNwo9UEcybgotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0t
      gpgkey.dbpinfra.sec.asc: LS0tLS1CRUdJTiBQR1AgUFJJVkFURSBLRVkgQkxPQ0stLS0tLQoKbFFjWUJHV2YzcllCRUFEU2NBbEZSZVU1eDJ2MmtQeWkyb1Rqb25OTmhGSitoUmhxcnNvc1lVRUdTWlg2NzF4dQo5T29ML1pUa2ZvOEdHNUZMMlNCZE1mTldhWnpxOVhRNDJjVGtjSWFKeEJ3emF4WGVoQ04zbmpUMEtnakFKV1RUCk83eGIwMDJ6QWp2aG1EMnMrdkplLzlhOHNDaUZGUWw1dGlqVkx5VW90QmtUNTJxaFhKSkJkdkFqZlRJREprbGMKeXZwS0hXVEU0SXdMN2JrdGFvcFlTSFRFcERWTHdkbVlqODNyWHRWd2FBV3FwZFVLVDkya0YxaHc0VldHN0xIZQo4TlV6NFRHZGNZRGY2QkJKZ0h0eTY4NG5YQjJ3ZnBZb0NkUkR3Nks1TXNwYlJQS3E3amMwSldobXpXanhCbHIrClY2Tm5SSmg2UWNNK2VoQmhURk1MSjIyRlBqZEJlbllBa0EzcWwxVlhSTzRnU29xUER0YUE2YThpN0NaZFRoQUsKVS9CNytJbk5PTGNTUlFDZTMyYzk0dkRvSVFBcjhUOHNCZkJwSWRMYTBtTmRweEExK0g2UkFrdkZOMjlnOXBJTgo2cUNlaCtpb3haY2w3NjdMbXVxTmNITVhCVGxlaUhKUStQMmxxWkpCSUxSa2ZLNExvOGp1a2VsVVlVRndsdkt0CnFVNFpHRS9jS3hlWGVqUmg5K2MwS1JJaDlCVGRRRW5tRXBEZWRLRWFFOFNmdTRDVXR2aUFuVUtoQVZHMmlOcTIKbndKUmNGMjFZcCtvdlBweWQvajB4M09rWkoyQ0ZiWXBLYzdmL3dLRHZ0Zy9IR3FWaEZuV2JDc2xWR2NVRmxhUworYldNWTk0eWgvZkVMVVRnMDNuS0ZwNjVMWlQ0NFpKY2lwcU1FY0t1Y2YrMjU4VWhhYlk5TFlMNmZRQVJBUUFCCkFBLytMNFlteWRLeHBGMVJtQU1CVXdQM2kvTUZpQ1dRZmNzd0N2UERhOGRnNkhzWTJHMVRHaW5NYTMzT3NOV1cKRmtLR2l6TVRXSWl0MUQrUXRRMU92SUlOc2F0cDd0WHZxbnNPR3MwTHQzbHVxdytOSDF1eWkvUExJNCt5VmZGMAp0WXRzcmxLVUJ2bFBOUml4WmZDc3phUmlUMWJRMVFMclFPLzd5RXBBSzNHaFpOcGl2NHhYZUJITStZenUwM21FCmx6TU9KV0FRczBSVnZvejVEazFPaDJJK2xsKzU0eU5TMkVtUU5iNTRweFN3bi9sN2w3ZC9xZ0lJbkNsSXk2NDAKOVJ3VEJZNXpFcTZIUmFOTGZ5N3ZXVVp5L2dUQ0RJSVlhZ2xGcG0yYTRQZHJ2diszcWVzT0JLK2xFdTdPWXBuVQpicGtoZHQvR1IxZ1ZwMGc0TVZ6bkpsUmlGOFpVY2ZtKytZVXh4WmpCVXB6R1I0bWxiWWdmRW5ELzBhRXNhRldVClVrWHcxQUNhWENOQ0c5R0llYkpDWlYwcy93VmFQdkU4M2hPRHduS3hNOXM4T1Vjb0x1bUg3L0lCNDJkWHVCMkwKVzhqQUlQR0FmQk8wc0lxbHpLSmh1Nk9GZkl2RG1yd2ZVZytIQTVTSmJ3QXozd1M5NUwwc0FoQ1h0c1lXYmFtSQp6ZVZVVUg0djB2VlNQT2NaMUhmUVRqM3k1S1VLWTQyNVFUenM2OEZTeXJwRHd0YkpmcjFiT3BUTGNCNkpyYVQyCnFNQ1U0dmZpdnFJazBvQUY0Rkd5eE0rMEV4MjdCUFdmOWlaNXovUVFOT0srWjRIK3krRjIxa3kreWJkQ0I4Z3gKUkEycTFYc0U2RXNYS0lJTnFrUjdmMG5lVTJobHVpVTJYcFpaQ25KUWZBd1ZtUjhJQU9kTXY3WWlRcm9xd1NzegpPZzMwdzVNVHlucmVRNU1OcGFlNHRPbjlHMndPaDZtU3d3bTdrcERySUNYU2hmUXREbkdvQjRZSW5tbTJINE56ClhtMUJVTzZ3cGFzWTFqOVNTOTJpdTRzMnRNYnJRb0VCSVAvYkJNRHRJRlAwZVEzOVdibmpoOXEwVHJQT1ZWakwKMWZnUktsUlhiWitrb1pqU2h2NWdSY2pDdnJxcEtLVEZneERlUENyTjZHa3FXcEtNc082UlRXeWdaWTNmUm15egpsWW03NTJpVzhBclphektXRnByMitkYy9PTko2OG40MmtESmx4Q3RORDJvekduOGx6TkdoclAzVngveDB0K0dYCldTOE5wcDNzMU1NcjlDSW5RU09DdHU5T0ZCa3c1c1pueE16dTNDUlJhM3JRZlNjVzV0VWRoRXZIRWxUS3R3WUQKVWkzNlhrOElBT2pvOWE3bVlISDh6UzM0eVE3QlZEZ0NydlVOQzdTZ2VlSFhKZzhDNDhYMTlSeHFOR2ZTK2FNUgpwSzlUQllDMDVrSUkxUTNkWUFHSXVHWUUyVTVvaCtSZFB3T2trbk93OVg0TlRuM1ZtSHMrcER6TTd6NHYwZDJECnpjWDFqL0VqcXRBanJPdHZESXJOcHdjWEZYRWpoK2FFVlV3WkJSdi9XMDhLdlN3eGZCaVhveXdFckkwNFlkbUYKL2pyZVhyU3c3VmhxUkt3L1VyNi9MSk1Zb1JBS2lwdjNpY3ErRW5Cb3lnMEJUVEJmbW1zajA1TVhUVmlWN2VpRAp5WXpSUVd5Z3ROZ25yL0FJT0dxc21SM3o2bHNjZ1RTTVNqd041ME1OcXVqNmoxcWVZNGh4a1JSdzA4STh2QnUxCk5CaU41bU0zM1NDYTJLN044NWxidzltOTAzQlpVM01JQUs4N25TWWFkOXE5MTArd1J4M2ZhSExva1JGTlB3RWMKVFVqbVQ0WG5maGYyVGM5SEZxQjRuUWVlQXduMjhKcjdCdi9RUU15QWhkbjlXZk9ObUMzVS82ck1JUlE0cDI4Qwp1eWhPTnhJaVhUSWpTL21aQndLa0NDTXV6WUo1cTJmL1lxMU9ZRE1iNHpWODRVdkhtN0U1MDRRc0lROGpNOVd6Cnh0bzNnV2RqczlLUzEyVVJ5RjFuWjM3S0k1emRBMld6ajVVL21ZaUVRMXB5MFpqdzJ4QzhwMkQzNHI4TDdhejUKSmhTOGVicHUyTnhNMlRRNlJCREVSbnZ0RnpZZEZOVUh4V29uR3E4OHRNZmYxU3pLdUQxNHUrTDIreE9uMXNtLwpzZ3huNUVlRFRJRDMwWVNOeEltRHhRN2IxY3Q3bDg4Q2NIZXhHYXJ3ZjZpRmFYU0E3LzByckQrRDdiUW5aR0p3CmFXNW1jbUVnUEdSbGRtOXdjMEJrWW1sc1pIVnVaM053YkdGMGRHWnZjbTB1WkdVK2lRSk9CQk1CQ2dBNEZpRUUKM0RtYkRyUENCOGZTNG1aUHFhQ0ZkVnhsTDRvRkFtV2YzcllDR3dNRkN3a0lCd0lHRlFvSkNBc0NCQllDQXdFQwpIZ0VDRjRBQUNna1FxYUNGZFZ4bEw0clNWUkFBcVhFQlJiR0tzV1BLcE1IdjNTWWhIeEF2ejFCMmNxNUp1aEhlCmRLZkFvMEhpcEN4Y0pXQVJCbUR2OVlEQzZmL0NGcTBQOUJTcHlUWHFKcTRiU3pWdEhNOE5Jcmh4UmJLVlRuTkQKOEE3UDhDLy9OODlvamtVcTU3TnNnYUpURUp4azltZ2taK2JHbmpUWG5YK2ZFd3dJWThUVXdtLy93d3k2TXdvdQpMc0J5UUFqRjRsZExuME10YVJyWkx3bzMxTXU5dk9yY20yUWZCanZqR0RTWWhJaEZMenJWTXdvU21CSjFEcGlOCnBBYkR6MzdOTlFDSGlhbkpWRkxwUW04bFEzTWpCUDdmWHlHSDFHWGFJNWtURUgzMlVTOUtFS2w0bHZwbmRVOFkKUFhPT2pXeFE0cVpiSVZsY2RmK1lhWUU5dzR5ZjRtNWI2WmxrclBXSzBxOC9Gc0ZEbXYxTklmazhaOTZKU1ZCcwpiLytNOVFVQmZpeC80QThjTG93TWZOVlRQZ1dBQmZEaElNM3N3L1lTNDVLcUgrWGZjT2VHeDVvQnRJTkdSY0pJCmx4cGhYbENOa2dhYlpjQ1VFZVhleEZiOXlVZmhTSTdsb01XSGowT040VldZdDNNakN0S3pqVDlWRGdaNkpscFMKWTczR21ZbDB3dVhObHhzY2haQnVYNVFPVmZnclhScFJyMGVsTm5aa0NrbmNTSmJHbTRzYWZmYi85ajFvNVNHOApxbjZCcklzMnpDYVQwOTlGWWRhUGJPYk04a0NiMXhXODNiZ2FITGszOWE0ODVHaWtQaFhFUlVMY3Vkd21IV0lFCnNJWjZhbEJNdlhCQlJMWTB5V1VEWU8zdHppdytzbFpvcWU3TTlQdmk2cGFHVmc3OEJXeXREUi9QVzJCOThjVlgKVWdKTmZHT2RCeGdFWlovZXRnRVFBTDlnVTRnSU9hMGJJWDNTS2xxK1FQZ1Z5N1dTTmFnUXV0djFVK3BsTW11Ngo4eUxsbGYvaDRJUUZ0L2dDZTZHcThnUncySmQzT1FSekhsbEUxOXNGODd5VWc1TGUrTURMMXd0MHJnUkdSSGdSClk2ZGhieFU0bUdhUzE5TTB5bXM5cnZJNnpBais2dEpmck42UmtSc0lXVm9Mdm94SW5RWW5zTHdrcUR5cUVYMFUKSTRVQ1RrWGVaNFV2Y0V2UEtKTTZTYzdNVzF4dDRpai9QYjd1V0RzWUJpSGVTME1rZFNkZFd6N1FxTURRbVFrMAprdU5PVzdiZkpSU0ZTU2hzcEY1d1c5dXRaYkNNek92N3VvQ3BobnJZWUtjL05xUGF3UmwxdHM5bkorQmFVWS9vCnZhTWZTL0wvemVmcjc2WEIxM0xZVjBCSmdPWEh1TTAzY0c0TGU1ZTJKY2UwRW9GMTBHOU5LVXI2QkNveTBEM2IKcEpPUXVjV0F6eXh3YUQ4cUFVZFpkTDlPNUFFMFpyVU5xdzF3bndvZGlsYitQZHZvV1B0bldSTmtMdHFvaXJRNQo1MkljcUZJbFVYU0pxMTNKM1hRUGpNSFB5cC9zcCtPQWYrdFN5ZVA3VjE0RDZEUzM5UVBncFZsNWRhM2ZCTTVPCk11NDZsSlErM2pnTFV2ZHJMY3FSRVpkeENZUzM1cFBJcDE2RU13bVo1ZmQ5S3hRVWRxOUkyRHFqak1tSExSZmsKMmd0TyswenNtTVQxSks5Rk9ack1Fc2dNa3dCQ0d4cHJQcDVOMkI1WkZJMnNqd2dkYWw5WXlCazFKdGhCeW5FUAo3SDUzWDFQQ0dpajFhcEN3WE9lTEhBUmIwcVA1QzNJYTF5c2p6OFRINXA2Mmd1M05FL2RLamZ0U2Y2cWM3Y0d6CkFCRUJBQUVBRC9rQnJieFcrdGJyUHZDSTFwS0dRQm1LN3ZoTG5BQWpXQjJtNldwRUtjcUJ0MmZNMmYyTWpaMkUKMUJXNktwMngzREZ1c2E2MHJvOEplYy9pVmtsbFNDU252MkVzcFRONVlnYzBTb1VsWWlxd3VjaWJ0UGNWbmtoVApYZ0hOZmk3RHlPZmV6S0x5R21YQVZPK25QNCtna0lFS2JKYk9KbjRNWlh5NnpsTHdCNUp2c3dEem5TZEhMc0h5CjEvc2NMeDlJaitTY3M4TENpVjFhZkd2UFg4b2ZlcE1LRFpXdi9hZVhJZktBcVdoMkdzd0YvbHlpVmx4NTMwL0gKWWJyRitrbHBHRjZqbllMbHNZMVdDU1R4cDJaekpvdmdOTk4wdWpNUWpoczBab2FyQkkyQ21SSlF3L3M1L20vYQpOOHNEZktEdkt6MTlRYm9WYm5lZlhsZG9hTmc3aTB4VTg2VHdOMXA5UDM0Szk3Tk1xalphYjZpZTUzZzFRM1Q5CjdnV3JnLzNBbVU5MG9mb2NQaW8vRGMzT2k5MGhJYUxSMGRjc01iN1RpeDllTkp0VXN6enlJaXh5Vkd2S3dXTkIKSDNrSXgyYW1paEpxZVpwNmNxY1Y4RXBRb3FqdHhyc2pYdjljTFA0R2NnTGMyOUdsalozb3lveFFYNHJJUmNUdwpoL3lEdmRua0dWV2FEbURyaXJpYjZWUmdXR1RYaGE3UE00MmdqSGtvTnFRcWpFN21hcUF1ZnhWK2pMYTMwejlJCnhxdnNzQzgzdXRYdWlDVjc5OFVFdzNSdmZiRkZ0b0NRaXFXVzI3bUFETWQ4V1V5WjRBT2s5djY5ZEtoNHNCUFEKbXRDOFMrOXI2dG45TFZHVEQ4T2k2RUgzL04xRFl4OUYxNUtOQkx0dDFxMDVnczBBSmcvV1FRZ0F6YVNuZ0RraApKbTFxVDdYVTM5emhyUmlEZEIxL1orT1gwUDBrY0s1TEhQWVNCNllxMy9hWVNJVENDK01PNUtNbk81T3VSMWFvCmVHN0liOUxTQ0hnWHdKTHNleWViVjNuQSt1U0ZRK1NEUk91Q2dCYUpPS0Ezdzhack5URDM1MU1pT00vYXZqQ1kKZG8vMUk3MDVlZXBVMzBoSUYrdzhpUnIvQVZlZk4yR2RYUDRWK1I5MWdzZmU5a3RWQnQxRFZqUE84cFpESDFtTAp3WGs4cEF1NGkwYms4K2hJUExIcmNOSVE4cm1JSDBBbWlaTERnWTlnWG00R0VtTmVrRFA1dHI0cXZpSjYzRW5CClRLbVh5ano0UG1peVM3aFRDd2tVejBBSU56eVJzL0JhcENKNEZ4dHpkWWppM1J0NXdxWDhSYkdHeUx4MWloTUQKV1pqeE01bkxVY3JmL1FnQTdqMVBKRG9ubTFnTDZhMlpHcVB1SGVyYnBtdmFHR3kraW5td0g1RVJoVC81ZmIvbgpBS0FzaG11Y0ZMZzY0YVArV21YV01MYXVMMFhTRjAwemdVL1dZSVBTWWJQNXRzN3krcnNISncyMDdFM0tmK0lnCkg4Q3ArclAvcm5XY1V6cERmbzRJSWdNRUZRUVZCSEllTTdoeW5QNDIvcVRjenV5eUFxVXpBM3ZwbXFLSlhhYUkKUGZXVTZhU1VWK2hqYkNNQlVYYi9XcWNEQzhoU3grU2YwODdMODc5cGlBMVc4RFpvRWFFaHdYL2FxVlNvUXYyNApoaG1BaXJWTEFnSk8raUprQzhIa3Q0MWd1TnZYRkhxSGI5L0lSMk9PTEIxb2NCVmU3M1drMjdqMVBldEk0d3VCCldWYWVUVi81SnRjNDBHc2ZEekRVczBnVUZjT1dsQndJcm1NZmJ3ZitMd0lVMTluWFY5L3NaYjU4dHc2STZ5eDAKcE4vbHUzQy9zL1VEeUgvUkYvU0t3UUpod0ltamJFbnlUM20xZWFYVGhmb0hId3BzRXR6SXNZbHlBRGl4OWFGSApSejhFMW53Q3JtNysxbHpnU1pxR0NTanNRc1E0dXhEZ2EwNzNiUGJubTJIS2w3TEs5cmlLajdpNmxQd3huQ1o2Cko4L3hJMExHN0pscFlIU1lUNjE2QVFHNVpsRWczekt5V2RQVzZvc0N1SUNWQVBhSkhjeHVDL0Q0citmUGFjaXEKQ1EvZ3NhZU83ejEzcDJ6bGlvdlpzL1dMQitHMTJWVGlZMW5LS2FSbm5rZFVVQk1ScDZ6Um4xNFQ0MzlWcEExcApDV0ZWY2tVb3JqT3FaWkhzSElQMTF5N21rUzJGbytKTEd1ajBwVXRPSEg5RzZlSENuaUhTczRzbWZMM3VRcEV6CmlRSTJCQmdCQ2dBZ0ZpRUUzRG1iRHJQQ0I4ZlM0bVpQcWFDRmRWeGxMNG9GQW1XZjNyWUNHd3dBQ2drUXFhQ0YKZFZ4bEw0b0EzQS8vWEh2TkZDQ3l2Y01oY2cvWmMrRmw1WjR0T3k4OTlYY3dnN0Z6bnNWUWJjeWlkeWcvK2lyNgpDTGptS29ybEFtV3pPR2g0K1NNK2FhRkdtbVIzVU9UVWd0QldsOFVYd1Y3UEJkektCY1JyUEMvdHRMcWpIa3Q2CmFmZitBT3lMSUxFN1Nkamo0T0VBNXp6N3duMU16VGpnbEVSMXhxakdYUE15UHljMi9CclpTZ0tqT08wUEc3ZzgKQnl3RVZOTUZxTlJrcHhDR0VjWWZLY3VmWG5qRFFEOE9tU3FSL09GUStlREFQb284dTVWdTFBSTdjenhRSVljZApwMUtTR1hIL3dvTUgxZUxUVFRMb1lRZDhJalVTRkM1VzdITTcxc2pPc2t3MWlRblNxN0hwdzE5NHdlME1RazVkClFsNWF4QUhDR0lxU2VxUHMxSmFOazFUTzF5UlNZSXhhVFExeVQvNjFEUGYzMmJpbTZHcmJPdmtGQXhQM2pBK3YKWmk5Q215dmdPMFp1QTlSWDl4b3B5SDBOZUFrY3IrS1NHWDZCalA5T25YbTJ2eGhHMTV6U0pqcFZKc1NFRFdEUQpzQ2llTEdWcjhBMWp6cGtPRTVuZ1luNE1xTmsraE03WGI2RElqV1Jmc2JCWXZydzBZKzlZRDFiTXVUWERtL0ZZCmQ2MnBqKzV0VmR2WlJoYXVmMGxVNnZTV3ZCRC9nRjR1ZklTck5FMWZUQU1rdVdid3k0OHJCWEtVbE96REJrQ1EKVGxFQi92Y2JONTNzbFRXZGZrQUhseEU1Y2lWdjBsTHk5VFNPZk9YQzJQUlZFMnpOZklMeVo3N09yeTRiTU16UApHUURyM09PMUJkS29EcXIvV3g0ZG9sQmYweTVIZ010cmJlR3BONzYxNzNxYy9vRUsxUDZFaHpzPQo9R21IbQotLS0tLUVORCBQR1AgUFJJVkFURSBLRVkgQkxPQ0stLS0tLQ==
    s3_bucket_name: infra-moodle-backup-dev
    cluster_name: dbpinfra-dev-moodle-01
    endpoint: https://s3-eu-central-2.ionoscloud.com
    secrets: 
      s3_access_key: "00b0fb474e8522f9011c"
      s3_access_secret: "ZVHFA6ehPsAt+osHuFoIBwy6ihTYXUMULjXnAowo"
      s3_endpoint_url: "https://s3-eu-central-2.ionoscloud.com"

    rules:
      - apiGroups: [""]
        resources: ["pods", "pods/exec", "secrets", "persistentvolumeclaims", "services", "deployments"]
        verbs: ["get", "list", "create", "delete", "patch", "update"]
      - apiGroups: ["apps"]
        resources: ["deployments", "replicasets"]
        verbs: ["get", "list", "create", "delete", "patch", "update"]
      - apiGroups: ["networking.k8s.io"]
        resources: ["ingresses"]
        verbs: ["get", "list", "create", "delete", "patch", "update"]
      - apiGroups: ["batch"]
        resources: ["cronjobs", "jobs"]
        verbs: ["get", "patch", "update", "list", "delete"]

  restore:
    enabled: false # Only to be used to restore a snapshot with the dbp-restore script
    rules:
      - apiGroups: ["apps"]
        resources: ["deployments/scale", "deployments"]
        verbs: ["get", "list", "scale", "patch"]

  moodlecronjob:
    rules:
      - apiGroups: [""]
        resources: ["pods", "pods/exec"]
        verbs: ["get", "list", "create"]

infratools:
  repository: schulcloud
  image_tag: 4.0.3

moodle:
  image:
    registry: ghcr.io
    repository: dbildungsplattform/moodle
    tag: "4.1.11-debian-12-r0"
    pullPolicy: Always
    debug: false
  moodleSkipInstall: false
  moodleSiteName: "Moodle"
  moodleLang: "de"
  moodleUsername: admin
  moodleEmail: devops@dbildungscloud.de
  allowEmptyPassword: false
  extraEnvVars:
    - name: PHP_POST_MAX_SIZE
      value: 200M
    - name: PHP_UPLOAD_MAX_FILESIZE
      value: 200M
    - name: PHP_MAX_INPUT_VARS
      value: "5000"
    - name: MOODLE_PLUGINS
      valueFrom:
        configMapKeyRef:
          name: moodle-plugins
          key: moodle-plugin-list
  extraEnvVarsSecret: "moodle"
  existingSecret: "moodle"
  persistence:
    existingClaim: "moodle-data"
  resources:
    requests:
      cpu: 300m
      memory: 512Mi
    limits:
      cpu: 6
      memory: 3Gi
  mariadb:
    enabled: false
  externalDatabase:
    type: "mariadb"
    host: "moodle-mariadb"
    port: 3306
    user: "moodle"
    database: "moodle"
    password: "moodle"
    existingSecret: "moodle"
  service:
    type: ClusterIP
  ingress:
    enabled: true
    hostname: "moodle.example.de"
    tls: true
    annotations:
      cert-manager.io/cluster-issuer: sc-cert-manager-clusterissuer-letsencrypt
      nginx.ingress.kubernetes.io/proxy-connect-timeout: "30s"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "20s"
      nginx.ingress.kubernetes.io/proxy-body-size: "200M"
  metrics:
    enabled: true
    service:
      type: ClusterIP
    resources: # We need those resources so the Horizontal Pod Autoscaler for moodle can read the moodle cpu consumption correctly
      requests:
        cpu: 10m
        memory: 16Mi
      limits:
        cpu: 200m
        memory: 256Mi
  extraVolumeMounts:
    - name: moodle-config
      readOnly: true
      mountPath: /moodleconfig
  extraVolumes:
    - name: moodle-config
      secret:
        secretName: moodle-config
        items:
          - key: config.php
            path: config.php
          - key: php.ini
            path: php.ini
        defaultMode: 0644
  podAnnotations:
    moodleplugins/checksum: '{{- include "dbpMoodle.pluginConfigMap.content" . | sha256sum -}}'


mariadb:
  enabled: true
  global:
    storageClass: "nfs-client"
  image:
    tag: "11.3.2-debian-12-r5"
  auth:
    username: "moodle"
    database: "moodle"
    rootPassword: "moodle"
    password: "moodle"
    existingSecret: "moodle"
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
  primary:
    resources:
      requests:
        cpu: 250m
        memory: 256Mi
      limits:
        cpu: 9
        memory: 3Gi

postgresql:
  enabled: false
  image:
    tag: "14.8.0-debian-11-r0"
  auth:
    username: "moodle"
    database: "moodle"
    existingSecret: "moodle"
    secretKeys:
      adminPasswordKey: "PGSQL_POSTGRES_PASSWORD"
      userPasswordKey: "postgresql-password"
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
  primary:
    extendedConfiguration: |
      max_connections = 800
    resources:
      requests:
        cpu: "250m"
        memory: "256Mi"
      limits:
        cpu: 9
        memory: "3Gi"

# Horizontal Pod Autoscaling Values
moodle_hpa:
  deployment_name_ref: "moodle"
  enabled: false
  # Moodle Autoscaling Values
  min_replicas: 1
  max_replicas: 4
  average_cpu_utilization: 50
  # The up and downscaling values to have more control over the speed moodle will be scaled
  scaledown_value: 25 # The max amount in percent to scale in one step per cooldown period
  scaledown_cooldown: 60
  scaleup_value: 50
  scaleup_cooldown: 15

# redis helm chart values
redis:
  enabled: false
  architecture: "standalone"
  auth:
    enabled: true
    existingSecret: "moodle"
    existingSecretPasswordKey: "redis-password"
    usePasswordFileFromSecret: true

etherpad-postgresql:
  auth:
    enablePostgresUser: false
    username: etherpad
    existingSecret: "moodle"
    secretKeys:
      userPasswordKey: "etherpad-postgresql-password"
    database: "etherpad"
  persistence:
    existingClaim: "moodle-etherpad-postgresql"
  primary:
    resources:
      requests:
        cpu: "50m"
        memory: "128Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"

etherpadlite:
  enabled: false
  image:
    repository: "ghcr.io/dbildungsplattform/etherpad"
    tag: "1.8.18.0"
  env:
    - name: DB_TYPE
      value: "postgres"
    - name: DB_HOST
      value: "moodle-etherpad-postgresql"
    - name: DB_PORT
      value: "5432"
    - name: DB_NAME
      value: "etherpad"
    - name: DB_USER
      value: "etherpad"
    - name: DB_PASS
      valueFrom:
        secretKeyRef:
          name: "moodle"
          key: "etherpad-postgresql-password"
    - name: REQUIRE_SESSION
      value: "true"
  volumes:
    - name: "api-key"
      secret:
        secretName: "moodle"
        items:
          - key: "etherpad-api-key"
            path: "APIKEY.txt"
  volumeMounts:
    - name: "api-key"
      mountPath: "/opt/etherpad-lite/APIKEY.txt"
      subPath: "APIKEY.txt"
  ingress:
    enabled: true
    annotations:
      cert-manager.io/cluster-issuer: "sc-cert-manager-clusterissuer-letsencrypt"
    hosts:
      - host: "etherpad.example.de"
        paths:
          - path: "/"
            pathType: "Prefix"
    tls:
      - secretName: "etherpad.example.de-tls"
        hosts:
          - "etherpad.example.de"
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "1000m"
      memory: "1Gi"

moodlecronjob:
  clusterRole:
    create: false
  serviceAccount:
    name: "moodle-php-job"
    create: false
  jobs:
    - name: php-script
      schedule: "* * * * *"
      concurrencyPolicy: Forbid
      failedJobsHistoryLimit: 1
      successfulJobsHistoryLimit: 1
      backoffLimit: 1
      restartPolicy: Never
      command:
        - /bin/sh
        - -c
      args:
        - /scripts/cronjob-script
      extraVolumeMounts:
        - name: moodle-php-script
          mountPath: /scripts/
      extraVolumes:
        - name: moodle-php-script
          configMap:
            name: moodle-php-script
            defaultMode: 0711

backup-cronjob:
  image:
    tag: 4.0.3
  clusterRole:
    create: false
  serviceAccount:
    name: "moodle-backup-job"
    create: false
  env:
    - name: MARIADB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: moodle
          key: mariadb-password
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: moodle-backup-s3
          key: s3_access_key
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: moodle-backup-s3
          key: s3_access_secret
    - name: S3_BACKUP_REGION_URL
      valueFrom:
        secretKeyRef:
          name: moodle-backup-s3
          key: s3_endpoint_url
  extraVolumeMounts:
    - name: moodle-backup-script
      mountPath: /scripts/
    - name: moodle-pvc-data
      mountPath: /mountData
    - name: duply
      mountPath: /etc/duply/default/
  extraVolumes:
    - name: moodle-pvc-data
      persistentVolumeClaim:
        claimName: "moodle-data"
    - name: moodle-backup-script
      configMap:
        name: moodle-backup-script
        defaultMode: 0711
    - name: duply
      projected:
        sources:
          - configMap:
              name: moodle-duply
              items:
                - key: conf
                  path: conf
                - key: exclude
                  path: exclude
          - secret:
              name: moodle-backup-gpg-keys
        defaultMode: 0644
  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 500m
      memory: 1Gi
  jobs:
    - name: backup
      schedule: "0 3 * * *"
      failedJobsHistoryLimit: 1
      successfulJobsHistoryLimit: 1
      command:
        - /bin/sh
        - -c
      args:
        - /scripts/backup-script
